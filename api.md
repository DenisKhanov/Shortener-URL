
# HTTP API

## Сервис сокращения ссылок предоставляет следующее HTTP API.

### Получить статус соединения с хранилищем.

Данный запрос публичный и при проблемах с JWT в coocie генерируется новый JWT и отправляется в coocie.

Формат запроса:
```
GET /ping HTTP/1.1
Content-Length: 0 
```

Возможные коды ответа:
- `200` - соединение с базой данных успешно установлено или локальное хранилище инициализировано
- `500` - внутренняя ошибка сервера

### Текстовый запрос на сокращение ссылки

Данный запрос публичный и при проблемах с JWT в coocie генерируется новый JWT и отправляется в coocie.
Пользователь отправляет запрос с оригинальной ссылкой, которую он хочет сократить.
Ссылка должна быть корректного формата, если ссылка не корректна то вернется ошибка 400.

Формат запроса:
```
POST /  HTTP/1.1
Content-Type: text/plain
...

http://www.example.ex
```


Возможные коды ответа:
- `201` - ссылка успешно сокращена
- `409` - сылка уже была сокращена ранее
- `400` - ошибка запроса

Формат успешного ответа:
```
201 Created HTTP/1.1
Content-Type: text/plain
...

http://localhost:8080/BqjxZmr
```
или

```
409 Conflict HTTP/1.1
Content-Type: text/plain
...

http://localhost:8080/BqjxZmr
```
### Переход на оригинальную ссылку.

Пример запроса:
```
GET /{short URL} HTTP/1.1
Content-Length: 0 
```
Возможные коды ответа:
- `307` - успешная обработка запроса и перенаправление на оригинальную ссылку
- `410` - если ссылка была помечена как удаленная
- `400` - ошибка запроса

Формат успешного ответа:
```
307 Temporary Redirect HTTP/1.1
Location: http://www.example.ex

```

### JSON запрос на сокращение ссылки.

Данный запрос публичный и при проблемах с JWT в coocie генерируется новый JWT и отправляется в coocie.
Пользователь отправляет один оригинальный URL для сокращения в виде JSON.
Ссылка должна быть корректного формата, если ссылка не корректна то вернется ошибка 400.

Формат запроса:
```
POST /api/shorten HTTP/1.1
Content-Type: application/json

{
  "url": "http://www.example.ex"
} 
```
Поля объекта запроса:
- `url` - оригинальная ссылка для сокращения;

Возможные коды ответа:
- `201` - ссылка успешно сокращена
- `409` - сылка уже была сокращена ранее
- `400` - ошибка запроса

Формат успешного ответа:
```
201 Created HTTP/1.1
Content-Type: application/json
...

{
  "result": "http://localhost:8080/BqjxZmr"
}
   
```
Поля объекта ответа:
- `result` - сокращенная ссылка

### JSON запрос с пакетом ссылок для сокращения.

Данный запрос публичный и при проблемах с JWT в coocie генерируется новый JWT и отправляется в coocie.
Пользователь отправляет JSON со списком оригинальных ссылок для сокращения.
Все ссылки должны быть корректного формата, если хоть одна ссылка не будет соответствовать, то вернется ошибка 400. 

Формат запроса:
```
POST /api/shorten/batch HTTP/1.1
Content-Type: application/json
...

[
    {
        "correlation_id": "1",
        "original_url": "http://example.ex/1"
    },
    {
        "correlation_id": "2",
        "original_url": "http://example.ex/2"
    },
    {
        "correlation_id": "3",
        "original_url": "http://example.ex/3"
    }
]
````
Поля объекта запроса:
- `correlation_id` - идентификатор ссылки
- `original_url` - оригинальная ссылка для сокращения

Возможные коды ответа:
- `201` - ссылка успешно сокращена
- `400` - ошибка запроса
- `500` - внутренняя ошибка сервера

Формат успешного ответа:
```
201 Created HTTP/1.1
Content-Type: application/json
...

[
    {
        "correlation_id": "1",
        "short_url": "http://localhost:8080/BqjxAmr"
    },
    {
        "correlation_id": "2",
        "short_url": "http://localhost:8080/BqjxBmr"
    },
    {
        "correlation_id": "3",
        "short_url": "http://localhost:8080/BqjxCmr"
    }
]
```
Поля объекта ответа:
- `correlation_id` - идентификатор ссылки
- `short_url` - сокращенная ссылка
  

### Получить все сокращенные ссылки конкретного пользователя

Запрос приветный и аутентификация производится по coocie в которой хранится JWT.


Пример запроса:
```
GET /api/user/urls HTTP/1.1
Content-Length: 0 
...

```
Возможные коды ответа:
- `201` - ссылка успешно сокращена
- `400` - ошибка запроса
- `500` - внутренняя ошибка сервера

Формат успешного ответа:
```
200 OK HTTP/1.1
Content-Type: application/json
...

[
	{
		"short_url": "http://localhost:8080/BqjxAmr",
		"original_url": "http://www.example.ex/1"
	},
   {
		"short_url": "http://localhost:8080/BqjxBmr",
		"original_url": "http://www.example.ex/2"
	},
   {
		"short_url": "http://localhost:8080/BqjxCmr",
		"original_url": "http://www.example.ex/3"
	}
]
```
Поля объекта ответа:
- `short_url` - сокращенная ссылка
- `original_url` - оригинальная ссылка

### Пометить ссылки из списка как удаленные (конкретного пользователя)

Запрос приветный и аутентификация производится по coocie в которой хранится JWT.


Пример запроса:
```
DELETE /api/user/urls HTTP/1.1
Content-Type: application/json
...

["KLvAyk4", "xRtP64y"] 
```
Возможные коды ответа:
- `202` - ссылка успешно помечены на удаление
- `400` - ошибка запроса
- `500` - внутренняя ошибка сервера

### Получить статистику по количеству сокращенных ссылок и количеству пользователей сервиса

Запрос могут выполнить только пользователи чьи IP находятся в доверенных подсетях.



Пример запроса:
```
GET /api/internal/stats HTTP/1.1
X-Real-IP: 1.1.1.1
Content-Length: 0
...

```
Возможные коды ответа:
- `200` - OK
- `500` - внутренняя ошибка сервера

Формат успешного ответа:
```
200 OK HTTP/1.1
Content-Type: application/json

...

{
   "urls":  1,
   "users": 3
}
```
Поля объекта ответа:
- `urls` - количество всех сокращенных ссылок
- `users` - количество пользователей
